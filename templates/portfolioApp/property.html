{% extends 'base.html'%}
{% load i18n %}
        {% block title %}
          <title> Property View </title>
        {% endblock %}
        
        {% block search %}
        {% endblock %}
        
        {% block content %}
        <br><br><br>
        <div class="dropdown">
          <button class="btn btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
            Jul 22, 2023
            {% comment %} [] date variable {% endcomment %}
          </button>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="#">Jul 22, 2023</a></li>
            <li><a class="dropdown-item" href="#">Jan 1, 2001 </a></li>
            <li><a class="dropdown-item" href="#">Something else here</a></li>
            {% comment %} {% for property in properties %}
              <li><a class="dropdown-item" href="#">{{property.flight_date}}</a></li>
            {% end for%} {% endcomment %}
          </ul>
        </div>
        <br><br><br><br><br><br>
        <div class="container mt-4">
            <div class="row">
                <div class="col-md-4 mb-3">
                  <button class="btn btn-link p-0" onclick="showContent('imageContent')">
                      <img src={{flight.overflight_thumbnail_link}} style="width:24vw; height:auto; border-radius:2vw;" alt="Drone Flyover" class="img-fluid">
                  </button>
                  <br><br><br>
                  <h2>{% trans "Overflight" %}</h2>
                </div>
                <div class="col-md-4 mb-3">
                  <button class="btn btn-link p-0" onclick="showContent('imageContent')">
                      <img src={{flight.exterior_thumbnail_link}} style="width:24vw; height:auto; border-radius:2vw;" alt="Drone Flyover" class="img-fluid">
                  </button>
                  <br><br><br>
                  <h2>{% trans "3D Exterior Model" %}</h2>
                </div>
                <div class="col-md-4 mb-3">
                  <button class="btn btn-link p-0" onclick="showContent('imageContent')">
                      <img src={{flight.interior_thumbnail_link}} style="width:24vw; height:auto; border-radius:2vw;" alt="Drone Flyover" class="img-fluid">
                  </button>
                  <br><br><br>
                  <h2>{% trans "3D Interior Model" %}</h2>
                </div>
            </div>
        </div>

        <div id="contentArea" class="container-fluid">
          <div id="imageContent" class="content-section">
              <img src={{flight.top_image_link_1}} class="img-fluid" alt="Full Image">
          </div>
          <div id="videoContent" class="content-section">
              <video controls class="w-100">
                  <source src="video1.mp4" type="video/mp4">
              </video>
          </div>
          <div id="modelContent" class="content-section">
              <div id="modelContainer"></div>
          </div>
      </div>

      <script type="module">
          import * as THREE from 'three';
          import WebGL from 'three/addons/capabilities/WebGL.js';
          import { FBXLoader } from 'three/addons/loaders/FBXLoader.js';
          import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
          import { GUI } from 'three/addons/libs/lil-gui.module.min.js';

          let camera, scene, renderer, loader, object;

          const params = {
              asset: 'resized'
          };

          const assets = [
              'Master',
              'resized'
          ];


          const assetURLs = {
              'Master': 'https://dl.dropboxusercontent.com/1/view/tyj325ko2a2x41e/Master.fbx',
              'resized': {{flight.overflight_link}}
          };



          init();

          function init() {
              const container = document.getElementById('modelContainer');

              camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 1, 200000);
              camera.position.set(-7500, 10000, 5000);

              scene = new THREE.Scene();

              const light = new THREE.AmbientLight(0x404040, 80);
              scene.add(light);

              loader = new FBXLoader();
              loadAsset(params.asset);

              renderer = new THREE.WebGLRenderer();
              renderer.setPixelRatio(window.devicePixelRatio);
              renderer.setSize(window.innerWidth, window.innerHeight);
              renderer.setAnimationLoop(animate);
              container.appendChild(renderer.domElement);

              const controls = new OrbitControls(camera, renderer.domElement);
              controls.listenToKeyEvents( window );
              const distance = camera.position.distanceTo(controls.target)
              controls.keyPanSpeed = Math.max(10000 * (500 / distance));
              controls.zoomSpeed = 10;
              controls.zoomToCursor = true;
              controls.enablePan = true;
              controls.minDistance = 0;
              controls.maxDistance = 50000;
              controls.minPolarAngle = 0.25;
              controls.maxPolarAngle = 1.8;
              controls.autoRotate = false;
              controls.target = new THREE.Vector3(0, 1, 0);
              controls.update();

              window.addEventListener('resize', onWindowResize);

              const gui = new GUI();
              gui.add(params, 'asset', assets).onChange((value) => {
                  loadAsset(value);
              });
          }

          function loadAsset(asset) {
              const url = assetURLs[asset];
              loader.load(url, (group) => {
                  if (object) scene.remove(object);

                  object = group;
                  scene.add(object);
              }, undefined, (error) => {
                  console.error(error);
              });
          }

          function onWindowResize() {
              camera.aspect = window.innerWidth / window.innerHeight;
              camera.updateProjectionMatrix();
              renderer.setSize(window.innerWidth, window.innerHeight);
          }

          function animate() {
              renderer.render(scene, camera);
          }


      </script>
      <script>
        let modelLoaded = false;

        function showContent(contentId) {
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('show');
            });
            const selectedContent = document.getElementById(contentId);
            selectedContent.classList.add('show');

            if (contentId === 'modelContent' && !modelLoaded) {
                initialize3DModel();
                modelLoaded = true;
            }
        }
        
        window.addEventListener('load', initialize3DModel);
      </script>



        {% endblock %}